 <h1 class="firstHeading" id="firstHeading">STD :: Shared_Mutex</h1> <table class="t-dcl-begin"> <tr class="t-dsc-header"> <th>C Thư viện<code><a href="../header/shared_mutex" title="cpp/header/shared mutex">&lt;shared_mutex&gt;</a></code> </th> <th> </th> <th> </th> </tr> <tr class="t-dcl t-since-cxx17"> <td> <pre data-language="cpp">lớp chia sẻ_mutex;</pre>
</td> <td class="t-dcl-nopad"> </td> <td> <span class="t-mark-rev t-since-cxx17">(C ++ 20)</span> </td> </tr> </table> <p>Các<code>shared_mutex</code>Lớp là một nguyên thủy đồng bộ hóa có thể được sử dụng để bảo vệ dữ liệu được chia sẻ khỏi được truy cập đồng thời bởi nhiều luồng. Trái ngược với các loại mutex khác tạo điều kiện truy cập độc quyền, Shared_mutex có hai cấp độ truy cập:</p>
<ul>
<li> <i>chia sẻ</i>- Một số chủ đề có thể chia sẻ quyền sở hữu của cùng một mutex.</li>
<li> <i>loại trừ</i>- Chỉ một chủ đề có thể sở hữu mutex.</li>
</ul> <p>Nếu một chủ đề đã có được<i>loại trừ</i>Khóa (thông qua<code><a href="shared_mutex/lock" title="cpp/thread/shared mutex/lock">lock</a></code>Thì<code><a href="shared_mutex/try_lock" title="cpp/thread/shared mutex/try lock">try_lock</a></code>), không có luồng nào khác có thể có được khóa (bao gồm cả<i>chia sẻ</i>).</p>
<p>Nếu một chủ đề đã có được<i>chia sẻ</i>Khóa (thông qua<code><a href="shared_mutex/lock_shared" title="cpp/thread/shared mutex/lock shared">lock_shared</a></code>Thì<code><a href="shared_mutex/try_lock_shared" title="cpp/thread/shared mutex/try lock shared">try_lock_shared</a></code>), không có chủ đề nào khác có thể có được<i>loại trừ</i>khóa, nhưng có thể có được<i>chia sẻ</i>khóa.</p>
<p>Chỉ khi<i>loại trừ</i>khóa chưa được mua bởi bất kỳ chủ đề nào,<i>chia sẻ</i>Khóa có thể có được bằng nhiều luồng.</p>
<p>Trong một luồng, chỉ có một khóa (<i>chia sẻ</i>hoặc<i>loại trừ</i>) có thể có được cùng một lúc.</p>
<p>Các mutex được chia sẻ đặc biệt hữu ích khi dữ liệu được chia sẻ có thể được đọc một cách an toàn bởi bất kỳ số lượng luồng nào một cách đồng thời, nhưng một luồng chỉ có thể ghi cùng một dữ liệu khi không có luồng nào khác đọc hoặc ghi cùng một lúc.</p>
<p>Các<code>shared_mutex</code>lớp đáp ứng tất cả các yêu cầu của<a href="../named_req/sharedmutex" title="cpp/named req/SharedMutex">SharedMutex</a>Và<a href="../named_req/standardlayouttype" title="cpp/named req/StandardLayoutType">StandardLayoutType</a>.</p>
<h3 id="Member_types">nhà điều hành ()</h3> <table class="t-dsc-begin"> <tr class="t-dsc-hitem"> <th>ATOMIC_UNSIGNED_LOCK_FREE</th> <th>Sự định nghĩa</th>
</tr> <tr class="t-dsc"> <td> <code>native_handle_type</code><span class="t-mark">(không phải lúc nào cũng có mặt)</span> </td> <td> <i>thực hiện xác định</i> </td>
</tr> </table> <h3 id="Member_functions">nếu không thì</h3> <table class="t-dsc-begin"> <tr class="t-dsc"> <td> <div><a href="shared_mutex/shared_mutex" title="cpp/thread/shared mutex/shared mutex"> <span class="t-lines"><span>chuyên môn)</span></span></a></div> </td> <td>xây dựng mutex<br/> <span class="t-mark">(chức năng thành viên công cộng)</span> </td>
</tr> <tr class="t-dsc"> <td> <div><a href="shared_mutex/~shared_mutex" title="cpp/thread/shared mutex/~shared mutex"> <span class="t-lines"><span>một đối tượng ngoại lệ khác để gán với</span></span></a></div> </td> <td>Phá hủy Mutex<br/> <span class="t-mark">(chức năng thành viên công cộng)</span> </td>
</tr> <tr class="t-dsc"> <td> <div><span class="t-lines"><span>chuyên môn)</span></span></div>
<div><span class="t-lines"><span><span class="t-cmark">[Đã xóa]</span></span></span></div> </td> <td>Không được xác nhận sao chép<br/> <span class="t-mark">(chức năng thành viên công cộng)</span> </td>
</tr> <tr> <td colspan="2"> <h5 id="Exclusive_locking">Khóa độc quyền</h5> </td>
</tr> <tr class="t-dsc"> <td> <div><a href="shared_mutex/lock" title="cpp/thread/shared mutex/lock"> <span class="t-lines"><span>khóa</span></span></a></div> </td> <td>Khóa mutex, khối nếu không có sẵn Mutex<br/> <span class="t-mark">(chức năng thành viên công cộng)</span> </td>
</tr> <tr class="t-dsc"> <td> <div><a href="shared_mutex/try_lock" title="cpp/thread/shared mutex/try lock"> <span class="t-lines"><span>Try_lock</span></span></a></div> </td> <td>cố gắng khóa mutex, trả về nếu không có sẵn mutex<br/> <span class="t-mark">(chức năng thành viên công cộng)</span> </td>
</tr> <tr class="t-dsc"> <td> <div><a href="shared_mutex/unlock" title="cpp/thread/shared mutex/unlock"> <span class="t-lines"><span>Mở khóa</span></span></a></div> </td> <td>Mở khóa mutex<br/> <span class="t-mark">(chức năng thành viên công cộng)</span> </td>
</tr> <tr> <td colspan="2"> <h5 id="Shared_locking">Mở khóa Mutex, nếu được sở hữu và có được quyền sở hữu của người khác</h5> </td>
</tr> <tr class="t-dsc"> <td> <div><a href="shared_mutex/lock_shared" title="cpp/thread/shared mutex/lock shared"> <span class="t-lines"><span>lock_shared</span></span></a></div> </td> <td>Khóa Mutex cho quyền sở hữu được chia sẻ, các khối nếu không có sẵn Mutex<br/> <span class="t-mark">(chức năng thành viên công cộng)</span> </td>
</tr> <tr class="t-dsc"> <td> <div><a href="shared_mutex/try_lock_shared" title="cpp/thread/shared mutex/try lock shared"> <span class="t-lines"><span>Try_lock_shared</span></span></a></div> </td> <td>Cố gắng khóa Mutex cho quyền sở hữu được chia sẻ, trả lại nếu Mutex không có sẵn<br/> <span class="t-mark">(chức năng thành viên công cộng)</span> </td>
</tr> <tr class="t-dsc"> <td> <div><a href="shared_mutex/unlock_shared" title="cpp/thread/shared mutex/unlock shared"> <span class="t-lines"><span>Unlock_shared</span></span></a></div> </td> <td>Mở khóa Mutex (quyền sở hữu chung)<br/> <span class="t-mark">(chức năng thành viên công cộng)</span> </td>
</tr> <tr> <td colspan="2"> <h5 id="Native_handle">Xử lý bản địa</h5> </td>
</tr> <tr class="t-dsc"> <td> <div><a href="shared_mutex/native_handle" title="cpp/thread/shared mutex/native handle"> <span class="t-lines"><span>bắt buộc phải là</span></span></a></div> </td> <td>Trả về đối tượng Xử lý gốc do triển khai cơ bản xác định<br/> <span class="t-mark">(chức năng thành viên công cộng)</span> </td>
</tr> </table> <h3 id="Example">Ví dụ</h3> <div class="t-example">
<p>Đầu ra dưới đây được tạo ra trên một máy lõi đơn. Khi<code>thread1</code>bắt đầu, nó lần đầu tiên đi vào vòng lặp và cuộc gọi<code>increment()</code>    toán tử &lt;&lt; (std :: basic_ostream &lt;biểu đồ, đặc điểm&gt; &amp; os, const std :: chrono :: tháng &amp; m);<code>get()</code>. Tuy nhiên, trước khi nó có thể in giá trị trả về thành<a href="http://en.cppreference.com/w/cpp/io/cout"><span class="kw1762">Điều đó cho tất cả<span class="me2">cout</span></span></a>, người lập lịch đặt<code>thread1</code>ngủ và thức dậy<code>thread2</code>, rõ ràng có thời gian đủ để chạy cả ba lần lặp lại cùng một lúc. Trở lại<code>thread1</code>, vẫn còn trong vòng lặp vòng đầu tiên, cuối cùng nó đã in bản sao cục bộ của giá trị quầy, đó là<code>1</code>, ĐẾN<code>std::cout</code>Và sau đó chạy hai lần lặp lại vòng lặp còn lại. Trên một máy đa lõi, không có luồng nào được đưa vào giấc ngủ và đầu ra có nhiều khả năng theo thứ tự tăng dần.</p>
<div class="cpp source-cpp"><pre data-language="cpp">#include &lt;Istream&gt;</pre></div> <p>#include &lt;Istream&gt;</p>
<div class="text source-text"><pre data-language="c">#include &lt;Prutex&gt;</pre></div> </div> <h3 id="See_also">(chức năng)</h3> <table class="t-dsc-begin"> <tr class="t-dsc"> <td> <div><a href="shared_timed_mutex" title="cpp/thread/shared timed mutex"> <span class="t-lines"><span>chia sẻ_timed_mutex</span></span></a></div>
<div><span class="t-lines"><span><span class="t-mark-rev t-since-cxx14">(C ++ 14)</span></span></span></div> </td> <td>cung cấp cơ sở loại trừ lẫn nhau được chia sẻ và thực hiện khóa với thời gian chờ<br/> <span class="t-mark">Các loại chính sách thực thi</span> </td>
</tr> <tr class="t-dsc"> <td> <div><a href="shared_lock" title="cpp/thread/shared lock"> <span class="t-lines"><span>Shared_lock</span></span></a></div>
<div><span class="t-lines"><span><span class="t-mark-rev t-since-cxx14">(C ++ 14)</span></span></span></div> </td> <td>thực hiện trình bao bọc quyền sở hữu mutex có thể chia sẻ<br/> <span class="t-mark">Kiểm tra xem một lớp có đại diện cho chính sách thực thi không</span> </td>
</tr> <tr class="t-dsc"> <td> <div><a href="unique_lock" title="cpp/thread/unique lock"> <span class="t-lines"><span>độc đáo_lock</span></span></a></div>
<div><span class="t-lines"><span><span class="t-mark-rev t-since-cxx11">unininitialized_copy_n</span></span></span></div> </td> <td>Thực hiện trình bao bọc quyền sở hữu Mutex có thể di chuyển<br/> <span class="t-mark">Kiểm tra xem một lớp có đại diện cho chính sách thực thi không</span> </td>
</tr> </table> <div class="_attribution">
<p class="_attribution-p">© CPPReference.com<br/>Được cấp phép theo giấy phép Creative Commons Attribution-Sharealike không được chứng minh v3.0.<br/>
<a class="_attribution-link" href="https://en.cppreference.com/w/cpp/thread/shared_mutex">https://en.cppreference.com/w/cpp/thread/shared_mutex</a>
</p>
</div>
