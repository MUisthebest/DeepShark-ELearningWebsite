 <h1 class="firstHeading" id="firstHeading">Quy tắc AS-IF</h1> <p>Cho phép bất kỳ và tất cả các biến đổi mã không thay đổi hành vi có thể quan sát được của chương trình.</p>
<h3 id="Explanation">Lưu ý: Đồng bộ hóa giữa các luồng tập trung vào việc ngăn chặn các chủng tộc dữ liệu (bằng cách thiết lập các mối quan hệ xảy ra trước khi) và xác định các tác dụng phụ nào có thể nhìn thấy được trong các điều kiện nào.</h3> <p>Trình biên dịch C ++ được phép thực hiện bất kỳ thay đổi nào đối với chương trình miễn là sau đây vẫn đúng:</p>
<table class="t-rev-begin"> <tr class="t-rev t-until-cxx11">
<td> <span class="t-li">1)</span>Tại mọi<a href="eval_order" title="cpp/language/eval order">sequence point</a>, các giá trị của tất cả<a href="cv" title="cpp/language/cv">volatile</a>Các đối tượng ổn định (các đánh giá trước đây là hoàn thành, các đánh giá mới không bắt đầu).</td> <td><span class="t-mark-rev t-until-cxx11">(Cho đến C ++ 11)</span></td>
</tr> <tr class="t-rev t-since-cxx11">
<td> <span class="t-li">1)</span>Truy cập (đọc và ghi) để<a href="cv" title="cpp/language/cv">volatile</a>Các đối tượng xảy ra nghiêm ngặt theo ngữ nghĩa của các biểu thức mà chúng xảy ra. Đặc biệt, họ là<a href="../atomic/memory_order" title="cpp/atomic/memory order">not reordered</a>Đối với các truy cập dễ bay hơi khác trên cùng một luồng.</td> <td><span class="t-mark-rev t-since-cxx11">(kể từ C ++ 11)</span></td>
</tr> </table> <div class="t-li1">
<span class="t-li">2)</span>Khi chấm dứt chương trình, dữ liệu được ghi vào các tệp chính xác như thể chương trình được thực thi như đã viết.</div> <div class="t-li1">
<span class="t-li">Mẫu &lt;class f, class tuple&gt;</span>Việc nhắc văn bản được gửi đến các thiết bị tương tác sẽ được hiển thị trước khi chương trình chờ nhập.</div> <div class="t-li1">
<span class="t-li">là trong</span>Nếu iso c pragma<a href="../preprocessor/impl#.23pragma_STDC" title="cpp/preprocessor/impl"><code> #pragma STDC FENV_ACCESS</code></a>được hỗ trợ và được đặt thành<code>ON</code>, những thay đổi đối với<a href="../numeric/fenv" title="cpp/numeric/fenv">floating-point environment</a>.<ul>
<li>Kết quả của bất kỳ biểu thức điểm nổi nào khác ngoài đúc và gán có thể có phạm vi và độ chính xác của loại điểm nổi khác với loại biểu thức (xem<code><a href="../types/climits/flt_eval_method" title="cpp/types/climits/FLT EVAL METHOD">FLT_EVAL_METHOD</a></code>và một kẻ phá hủy tầm thường. Số học số nguyên có chữ ký được xác định để sử dụng bổ sung của Two; Không có kết quả không xác định.</li>
<li>Mặc dù ở trên, kết quả trung gian của bất kỳ biểu thức điểm nổi nào cũng có thể được tính toán như thể có phạm vi và độ chính xác vô hạn (trừ khi<a href="../preprocessor/impl#.23pragma_STDC" title="cpp/preprocessor/impl"><code> #pragma STDC FP_CONTRACT</code></a>khoảng cách<code>OFF</code>).</li>
</ul>
</div> <h3 id="Notes">Ghi chú</h3> <p>Vì trình biên dịch là (thường) không thể phân tích mã của thư viện bên ngoài để xác định xem nó có hoặc không thực hiện truy cập I/O hoặc dễ bay hơi hay không, các cuộc gọi thư viện của bên thứ ba cũng không bị ảnh hưởng bởi tối ưu hóa. Tuy nhiên, các cuộc gọi thư viện tiêu chuẩn có thể được thay thế bằng các cuộc gọi khác, bị loại bỏ hoặc thêm vào chương trình trong quá trình tối ưu hóa. Mã thư viện bên thứ ba được liên kết tĩnh có thể phải tuân theo tối ưu hóa thời gian liên kết.</p>
<p>Chương trình với<a href="ub" title="cpp/language/ub">undefined behavior</a>, ví dụ. Do truy cập vào một mảng ngoài giới hạn, việc sửa đổi một đối tượng const,<a href="eval_order" title="cpp/language/eval order">evaluation order</a>Vi phạm, v.v., không có quy tắc AS-IF: chúng thường thay đổi hành vi có thể quan sát được khi được biên dịch lại với các cài đặt tối ưu hóa khác nhau. Ví dụ: nếu một thử nghiệm cho tràn số nguyên đã ký dựa vào kết quả của tràn đó, ví dụ:<code>if (n + 1 &lt; n) abort();</code>Thì<a class="external text" href="https://blog.llvm.org/2011/05/what-every-c-programmer-should-know_14.html" rel="nofollow">it is removed entirely by some compilers</a>bởi vì<a href="operator_arithmetic#Overflows" title="cpp/language/operator arithmetic">signed overflow is undefined behavior</a>Và trình tối ưu hóa là miễn phí để cho rằng nó không bao giờ xảy ra và bài kiểm tra là dự phòng.</p>
<p><a href="copy_elision" title="cpp/language/copy elision">Copy elision</a>là một ngoại lệ từ quy tắc AS-IF: Trình biên dịch có thể xóa các cuộc gọi đến trình xây dựng di chuyển và sao chép và các cuộc gọi phù hợp với bộ hủy của các đối tượng tạm thời ngay cả khi các cuộc gọi đó có tác dụng phụ có thể quan sát được.</p>
<table class="t-rev-begin"> <tr class="t-rev t-since-cxx14">
<td> <p><a href="new#Allocation" title="cpp/language/new">New-expression</a>có một ngoại lệ khác từ quy tắc AS-IF: Trình biên dịch có thể xóa các cuộc gọi đến<a href="../memory/new/operator_new" title="cpp/memory/new/operator new">replaceable allocation functions</a>Ngay cả khi một sự thay thế do người dùng xác định được cung cấp và có các tác dụng phụ có thể quan sát được.</p>
</td> <td><span class="t-mark-rev t-since-cxx14">(kể từ C ++ 14)</span></td>
</tr> </table> <p>Đếm và thứ tự của các trường hợp ngoại lệ dấu phẩy động có thể được thay đổi bằng cách tối ưu hóa miễn là trạng thái được quan sát bởi hoạt động điểm nổi tiếp theo như thể không có tối ưu hóa nào xảy ra:</p>
<div class="cpp source-cpp"><pre data-language="cpp">#pragma stdc fenv_access trên</pre></div> <h3 id="Example">Ví dụ</h3> <div class="t-example"> <div class="cpp source-cpp"><pre data-language="cpp">for (i = 0; i &lt;n; ++ i)</pre></div> <p>Nếu (sai)</p>
<div class="text source-text"><pre data-language="c">    x + 1; // x + 1 là mã chết, nhưng có thể tăng các ngoại lệ FP</pre></div> </div> <h3 id="See_also">(chức năng)</h3> <ul><li> <a href="copy_elision" title="cpp/language/copy elision">copy elision</a> </li></ul> <table class="t-dsc-begin"> <tr class="t-dsc"> <td colspan="2"> <span><a href="https://en.cppreference.com/w/c/language/as_if" title="c/language/as if">C documentation</a></span>vì<span class=""><span>           // (trừ khi trình tối ưu hóa có thể chứng minh khác). Tuy nhiên, thực hiện nó n lần</span></span> </td>
</tr> </table> <div class="_attribution">
<p class="_attribution-p">© CPPReference.com<br/>Được cấp phép theo giấy phép Creative Commons Attribution-Sharealike không được chứng minh v3.0.<br/>
<a class="_attribution-link" href="https://en.cppreference.com/w/cpp/language/as_if">https://en.cppreference.com/w/cpp/language/as_if</a>
</p>
</div>
