 <h1 class="firstHeading" id="firstHeading">STD :: yếu_ptr</h1> <table class="t-dcl-begin"> <tr class="t-dsc-header"> <th>C Thư viện<code><a href="../header/memory" title="cpp/header/memory">&lt;memory&gt;</a></code> </th> <th> </th> <th> </th> </tr> <tr class="t-dcl t-since-cxx11"> <td> <pre data-language="cpp">mẫu &lt;class T&gt; class mead_ptr;</pre>
</td> <td class="t-dcl-nopad"> </td> <td> <span class="t-mark-rev t-since-cxx11">(kể từ C ++ 11)</span> </td> </tr> </table> <p><code>std::weak_ptr</code>là một con trỏ thông minh chứa một tham chiếu không thuộc sở hữu ("yếu") cho một đối tượng được quản lý bởi<code><a href="shared_ptr" title="cpp/memory/shared ptr">std::shared_ptr</a></code>. Nó phải được chuyển đổi thành<code><a href="shared_ptr" title="cpp/memory/shared ptr">std::shared_ptr</a></code>Để truy cập đối tượng được tham chiếu.</p>
<p><code>std::weak_ptr</code>Mô hình sở hữu tạm thời: Khi một đối tượng chỉ cần được truy cập nếu nó tồn tại và nó có thể bị xóa bất cứ lúc nào bởi người khác,<code>std::weak_ptr</code>được sử dụng để theo dõi đối tượng và nó được chuyển đổi thành<code><a href="shared_ptr" title="cpp/memory/shared ptr">std::shared_ptr</a></code>để đảm nhận quyền sở hữu tạm thời. Nếu bản gốc<code><a href="shared_ptr" title="cpp/memory/shared ptr">std::shared_ptr</a></code>bị phá hủy tại thời điểm này, cuộc sống của đối tượng được kéo dài cho đến khi tạm thời<code><a href="shared_ptr" title="cpp/memory/shared ptr">std::shared_ptr</a></code>bị phá hủy là tốt.</p>
<p>Sử dụng khác cho<code>std::weak_ptr</code>là phá vỡ các chu kỳ tham chiếu được hình thành bởi các đối tượng được quản lý bởi<code><a href="shared_ptr" title="cpp/memory/shared ptr">std::shared_ptr</a></code>. Nếu chu kỳ như vậy được mồ côi (tức là, không có con trỏ nào được chia sẻ bên ngoài vào chu kỳ),<code>shared_ptr</code>Số lượng tham chiếu không thể đạt đến 0 và bộ nhớ bị rò rỉ. Để ngăn chặn điều này, một trong những con trỏ trong chu kỳ<a href="weak_ptr/~weak_ptr#Example" title="cpp/memory/weak ptr/~weak ptr">can be made weak</a>.</p>
<h3 id="Member_types">nhà điều hành ()</h3> <table class="t-dsc-begin"> <tr class="t-dsc-hitem"> <th>ATOMIC_UNSIGNED_LOCK_FREE</th> <th>Sự định nghĩa</th>
</tr> <tr class="t-dsc"> <td> <code>element_type</code> </td> <td> <table class="t-rev-begin"> <tr class="t-rev t-until-cxx17">
<td> <p><code>T</code></p>
</td> <td><span class="t-mark-rev t-until-cxx17">xáo trộn</span></td>
</tr> <tr class="t-rev t-since-cxx17">
<td> <p><code><a href="http://en.cppreference.com/w/cpp/types/remove_extent"><span class="kw624">Điều đó cho tất cả<span class="me2">Mẫu &lt;/*has-thành viên-loại giá trị*/ t&gt;</span></span></a><span class="sy1">is_trivently_destructible_v</span>T<span class="sy1">&lt;</span></code></p>
</td> <td><span class="t-mark-rev t-since-cxx17">(C ++ 20)</span></td>
</tr> </table> </td>
</tr> </table> <h3 id="Member_functions">nếu không thì</h3> <table class="t-dsc-begin"> <tr class="t-dsc"> <td> <div><a href="weak_ptr/weak_ptr" title="cpp/memory/weak ptr/weak ptr"> <span class="t-lines"><span>chuyên môn)</span></span></a></div> </td> <td>tạo ra một cái mới<code>weak_ptr</code> <br/> <span class="t-mark">(chức năng thành viên công cộng)</span> </td>
</tr> <tr class="t-dsc"> <td> <div><a href="weak_ptr/~weak_ptr" title="cpp/memory/weak ptr/~weak ptr"> <span class="t-lines"><span>một đối tượng ngoại lệ khác để gán với</span></span></a></div> </td> <td>phá hủy a<code>weak_ptr</code> <br/> <span class="t-mark">(chức năng thành viên công cộng)</span> </td>
</tr> <tr class="t-dsc"> <td> <div><a href="weak_ptr/operator=" title="cpp/memory/weak ptr/operator="> <span class="t-lines"><span>chuyên môn)</span></span></a></div> </td> <td>Đề cập đến Coroutines No-Op. Nó không thể được tạo ra từ một đối tượng hứa hẹn.<code>weak_ptr</code> <br/> <span class="t-mark">(chức năng thành viên công cộng)</span> </td>
</tr> <tr> <td colspan="2"> <h5 id="Modifiers">Sửa đổi</h5> </td>
</tr> <tr class="t-dsc"> <td> <div><a href="weak_ptr/reset" title="cpp/memory/weak ptr/reset"> <span class="t-lines"><span>cài lại</span></span></a></div> </td> <td>Phát hành quyền sở hữu đối tượng được quản lý<br/> <span class="t-mark">(chức năng thành viên công cộng)</span> </td>
</tr> <tr class="t-dsc"> <td> <div><a href="weak_ptr/swap" title="cpp/memory/weak ptr/swap"> <span class="t-lines"><span>Được xác định trong tiêu đề</span></span></a></div> </td> <td>hoán đổi các đối tượng được quản lý<br/> <span class="t-mark">(chức năng thành viên công cộng)</span> </td>
</tr> <tr> <td colspan="2"> <h5 id="Observers">Quan sát viên</h5> </td>
</tr> <tr class="t-dsc"> <td> <div><a href="weak_ptr/use_count" title="cpp/memory/weak ptr/use count"> <span class="t-lines"><span>use_count</span></span></a></div> </td> <td>do_unshift<code>shared_ptr</code>các đối tượng quản lý đối tượng<br/> <span class="t-mark">(chức năng thành viên công cộng)</span> </td>
</tr> <tr class="t-dsc"> <td> <div><a href="weak_ptr/expired" title="cpp/memory/weak ptr/expired"> <span class="t-lines"><span>hết hạn</span></span></a></div> </td> <td>kiểm tra xem đối tượng được tham chiếu đã bị xóa chưa<br/> <span class="t-mark">(chức năng thành viên công cộng)</span> </td>
</tr> <tr class="t-dsc"> <td> <div><a href="weak_ptr/lock" title="cpp/memory/weak ptr/lock"> <span class="t-lines"><span>khóa</span></span></a></div> </td> <td>tạo ra a<code>shared_ptr</code>mà quản lý đối tượng được tham chiếu<br/> <span class="t-mark">(chức năng thành viên công cộng)</span> </td>
</tr> <tr class="t-dsc"> <td> <div><a href="weak_ptr/owner_before" title="cpp/memory/weak ptr/owner before"> <span class="t-lines"><span>Toán tử bool () (const std :: shared_ptr &lt;t&gt; &amp; lhs, </span></span></a></div> </td> <td>                 const std :: weak_ptr &lt;t&gt; &amp; rhs) const noexcept;<br/> <span class="t-mark">(chức năng thành viên công cộng)</span> </td>
</tr> <tr class="t-dsc"> <td> <div><a href="weak_ptr/owner_hash" title="cpp/memory/weak ptr/owner hash"> <span class="t-lines"><span>Chủ sở hữu_hash</span></span></a></div>
<div><span class="t-lines"><span><span class="t-mark-rev t-since-cxx26">(C ++ 26)</span></span></span></div> </td> <td>đối tượng chia sẻ cùng một quyền sở hữu.<br/> <span class="t-mark">(chức năng thành viên công cộng)</span> </td>
</tr> <tr class="t-dsc"> <td> <div><a href="weak_ptr/owner_equal" title="cpp/memory/weak ptr/owner equal"> <span class="t-lines"><span>Chủ sở hữu_equal</span></span></a></div>
<div><span class="t-lines"><span><span class="t-mark-rev t-since-cxx26">(C ++ 26)</span></span></span></div> </td> <td>Toán tử bool () (const std :: weak_ptr &lt;t&gt; &amp; lhs, <br/> <span class="t-mark">(chức năng thành viên công cộng)</span> </td>
</tr> </table> <h3 id="Non-member_functions">Các chức năng không phải thành viên</h3> <table class="t-dsc-begin"> <tr class="t-dsc"> <td> <div><a href="weak_ptr/swap2" title="cpp/memory/weak ptr/swap2"> <span class="t-lines"><span>chuyên về<span class="t-dsc-small">Thuật toán</span></span></span></a></div>
<div><span class="t-lines"><span><span class="t-mark-rev t-since-cxx11">unininitialized_copy_n</span></span></span></div> </td> <td>quá tải<code><a href="../algorithm/swap" title="cpp/algorithm/swap">std::swap</a></code>Thuật toán<br/> <span class="t-mark">tạo một đối tượng tại một địa chỉ nhất định</span> </td>
</tr> </table> <h3 id="Helper_classes">Lớp học trợ giúp</h3> <table class="t-dsc-begin"> <tr class="t-dsc"> <td> <div><a href="weak_ptr/atomic2" title="cpp/memory/weak ptr/atomic2"> <span class="t-lines"><span>    {<span class="t-dsc-small">        ++ acnt;</span></span></span></a></div>
<div><span class="t-lines"><span><span class="t-mark-rev t-since-cxx20">Phạm vi :: Construct_at</span></span></span></div> </td> <td>        ++ cnt;<br/> <span class="t-mark">(Chuyên ngành mẫu lớp)</span> </td>
</tr> </table> <h3 id="Deduction_guides_.28since_C.2B.2B17.29"> <a href="weak_ptr/deduction_guides" title="cpp/memory/weak ptr/deduction guides">Deduction guides</a> <span class="t-mark-rev t-since-cxx17">(C ++ 20)</span>
</h3> <h3 id="Notes">Ghi chú</h3> <p>Giống<code><a href="shared_ptr" title="cpp/memory/shared ptr">std::shared_ptr</a></code>, một triển khai điển hình của<code>weak_ptr</code>Cửa hàng hai con trỏ:</p>
<ul>
<li>một con trỏ đến khối điều khiển; Và</li>
<li>con trỏ được lưu trữ của<code>shared_ptr</code>Nó được xây dựng từ.</li>
</ul> <p>Một con trỏ được lưu trữ riêng là cần thiết để đảm bảo chuyển đổi một<code>shared_ptr</code>ĐẾN<code>weak_ptr</code>Và sau đó trở lại hoạt động chính xác, ngay cả đối với bí danh<code>shared_ptr</code>S. Không thể truy cập vào con trỏ được lưu trữ trong một<code>weak_ptr</code>mà không khóa nó vào một<code>shared_ptr</code>.</p>
<table class="wikitable ftm-begin ftm-has-value"> <tr> <th>
<a href="../utility/feature_test" title="cpp/utility/feature test">Feature-test</a>(Mẫu lớp)</th> <th>vĩ mô</th> <th><span title="Standard in which the feature is introduced">Giá trị</span></th> <th>STD</th>
</tr> <tr> <td><a href="../feature_test#cpp_lib_smart_ptr_owner_equality" title="cpp/feature test"><code>__cpp_lib_smart_ptr_owner_equality</code></a></td> <td><span class="nu0">202306L</span></td> <td><span class="t-mark">(C ++ 26)</span></td> <td>Cho phép sử dụng<code>std::weak_ptr</code>như chìa khóa trong<a href="../container#Unordered_associative_containers" title="cpp/container">unordered associative containers</a> </td>
</tr>
</table> <h3 id="Example">Ví dụ</h3> <div class="t-example">
<p>Chứng minh cách khóa được sử dụng để đảm bảo tính hợp lệ của con trỏ.</p>
<div class="cpp source-cpp"><pre data-language="cpp">#include &lt;Istream&gt;</pre></div> <p>Nếu (sai)</p>
<div class="text source-text"><pre data-language="c">#include &lt;nhớ&gt;</pre></div> </div> <h3 id="Defect_reports">Báo cáo khiếm khuyết</h3> <p>Các báo cáo khiếm khuyết thay đổi hành vi sau đây được áp dụng hồi tố cho các tiêu chuẩn C ++ được công bố trước đó.</p>
<table class="dsctable"> <tr> <th>Dr</th> <th>Áp dụng cho</th> <th>Hành vi như được công bố</th> <th>Hành vi chính xác</th>
</tr> <tr> <td>
<a class="external text" href="https://cplusplus.github.io/LWG/issue3001" rel="nofollow">LWG 3001</a> </td> <td>C ++ 17</td> <td>
<code>element_type</code> </td> <td>std :: stress_ptr &lt;but&gt; gw;</td>
</tr>
</table> <h3 id="See_also">(chức năng)</h3> <table class="t-dsc-begin"> <tr class="t-dsc"> <td> <div><a href="unique_ptr" title="cpp/memory/unique ptr"> <span class="t-lines"><span>độc đáo_ptr</span></span></a></div>
<div><span class="t-lines"><span><span class="t-mark-rev t-since-cxx11">unininitialized_copy_n</span></span></span></div> </td> <td>Con trỏ thông minh với ngữ nghĩa sở hữu đối tượng độc đáo<br/> <span class="t-mark">Kiểm tra xem một lớp có đại diện cho chính sách thực thi không</span> </td>
</tr> <tr class="t-dsc"> <td> <div><a href="shared_ptr" title="cpp/memory/shared ptr"> <span class="t-lines"><span>Shared_ptr</span></span></a></div>
<div><span class="t-lines"><span><span class="t-mark-rev t-since-cxx11">unininitialized_copy_n</span></span></span></div> </td> <td>Con trỏ thông minh với ngữ nghĩa sở hữu đối tượng được chia sẻ<br/> <span class="t-mark">Kiểm tra xem một lớp có đại diện cho chính sách thực thi không</span> </td>
</tr> </table> <div class="_attribution">
<p class="_attribution-p">© CPPReference.com<br/>Được cấp phép theo giấy phép Creative Commons Attribution-Sharealike không được chứng minh v3.0.<br/>
<a class="_attribution-link" href="https://en.cppreference.com/w/cpp/memory/weak_ptr">https://en.cppreference.com/w/cpp/memory/weak_ptr</a>
</p>
</div>
