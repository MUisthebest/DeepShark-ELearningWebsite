 <h1 class="firstHeading" id="firstHeading">Sao chép các hàm tạo</h1> <p>Một hàm tạo bản sao là một<a href="constructor" title="cpp/language/constructor">constructor</a>có thể được gọi với một đối số của cùng loại lớp và sao chép nội dung của đối số mà không thay đổi đối số.</p>
<h3 id="Syntax">Cú pháp</h3> <table class="t-sdsc-begin"> <tr class="t-sdsc"> <td> <span class="t-spar">tên lớp</span>﻿<code>(</code><span class="t-spar">danh sách tham số</span>﻿<code>);</code> </td> <td>(1)</td> <td class="t-sdsc-nopad"> </td>
</tr> <tr class="t-sdsc"> <td> <span class="t-spar">tên lớp</span>﻿<code>(</code><span class="t-spar">danh sách tham số</span>﻿<code>)</code> <span class="t-spar">cơ thể chức năng</span> </td> <td>(2)</td> <td class="t-sdsc-nopad"> </td>
</tr> <tr class="t-sdsc"> <td> <span class="t-spar">tên lớp</span>﻿<code>(</code><span class="t-spar">Danh sách đơn tham số</span>﻿<code>) = default;</code> </td> <td>(3)</td> <td> <span class="t-mark-rev t-since-cxx11">(kể từ C ++ 11)</span> </td>
</tr> <tr class="t-sdsc"> <td> <span class="t-spar">tên lớp</span>﻿<code>(</code><span class="t-spar">danh sách tham số</span>﻿<code>) = delete;</code> </td> <td>(4)</td> <td> <span class="t-mark-rev t-since-cxx11">(kể từ C ++ 11)</span> </td>
</tr> <tr class="t-sdsc"> <td> <span class="t-spar">tên lớp</span>﻿<code>::</code><span class="t-spar">tên lớp</span>﻿<code>(</code><span class="t-spar">danh sách tham số</span>﻿<code>)</code> <span class="t-spar">cơ thể chức năng</span> </td> <td>             Không có p);</td> <td class="t-sdsc-nopad"> </td>
</tr> <tr class="t-sdsc"> <td> <span class="t-spar">tên lớp</span>﻿<code>::</code><span class="t-spar">tên lớp</span>﻿<code>(</code><span class="t-spar">Danh sách đơn tham số</span>﻿<code>) = default;</code> </td> <td>Consexpr bool any_of (đầu vào đầu tiên, đầu vào cuối cùng, không được tính p);</td> <td> <span class="t-mark-rev t-since-cxx11">(kể từ C ++ 11)</span> </td>
</tr>
</table> <table class="t-par-begin"> <tr class="t-par"> <td> <span class="t-spar">tên lớp</span> </td> <td>-</td> <td>lớp có hàm tạo bản sao đang được khai báo</td>
</tr> <tr class="t-par"> <td> <span class="t-spar">danh sách tham số</span> </td> <td>-</td> <td>không trống<a href="function#Parameter_list" title="cpp/language/function">parameter list</a>thỏa mãn tất cả các điều kiện sau:<ul>
<li>đưa ra loại lớp là<code>T</code>, tham số đầu tiên là loại T<span class="sy3">Không có giá trị</span>Thì<span class="kw4">hằng số</span>T<span class="sy3">Không có giá trị</span>Thì<span class="kw4">bay hơi</span>T<span class="sy3">Không có giá trị</span>hoặc<span class="kw4">hằng số</span> <span class="kw4">bay hơi</span>T<span class="sy3">Không có giá trị</span>, Và</li>
<li>hoặc không có tham số khác hoặc tất cả các tham số khác có<a href="default_arguments" title="cpp/language/default arguments">default arguments</a>.</li>
</ul> </td>
</tr> <tr class="t-par"> <td> <span class="t-spar">Danh sách đơn tham số</span> </td> <td>-</td> <td>Một<a href="function#Parameter_list" title="cpp/language/function">parameter list</a>chỉ trong một tham số, loại T<span class="sy3">Không có giá trị</span>Thì<span class="kw4">hằng số</span>T<span class="sy3">Không có giá trị</span>Thì<span class="kw4">bay hơi</span>T<span class="sy3">Không có giá trị</span>hoặc<span class="kw4">hằng số</span> <span class="kw4">bay hơi</span>T<span class="sy3">Không có giá trị</span>và không có đối số mặc định</td>
</tr> <tr class="t-par"> <td> <span class="t-spar">cơ thể chức năng</span> </td> <td>-</td> <td>các<a href="constructor" title="cpp/language/constructor">function body</a>của hàm tạo bản sao</td>
</tr>
</table> <h3 id="Explanation">Lưu ý: Đồng bộ hóa giữa các luồng tập trung vào việc ngăn chặn các chủng tộc dữ liệu (bằng cách thiết lập các mối quan hệ xảy ra trước khi) và xác định các tác dụng phụ nào có thể nhìn thấy được trong các điều kiện nào.</h3> <div class="t-li1">
<span class="t-li">1)</span>Tuyên bố của một hàm tạo bản sao bên trong định nghĩa lớp.</div> <div class="t-li1">
<span class="t-li">    const std :: chrono :: giây* offset;     // Chỉ giải thích</span>Định nghĩa của một hàm tạo bản sao bên trong định nghĩa lớp.</div> <div class="t-li2">
<span class="t-li">Mẫu &lt;class f, class tuple&gt;</span>Trình xây dựng bản sao được mặc định rõ ràng.</div> <div class="t-li2">
<span class="t-li">là trong</span>Trình xây dựng bản sao bị xóa.</div> <div class="t-li1">
<span class="t-li">    trả về std :: find_if_not (đầu tiên, cuối cùng, p) == cuối cùng;</span>Định nghĩa của một hàm tạo bản sao bên ngoài định nghĩa lớp (lớp phải chứa khai báo<span class="t-v">(1)</span>).</div> <div class="t-li2">
<span class="t-li">từ_sys</span>Trình xây dựng bản sao được mặc định rõ ràng.</div> <div class="cpp source-cpp"><pre data-language="cpp">Cấu trúc x</pre></div> <p>{<a href="initialization" title="cpp/language/initialization">initialized</a>    X (x &amp; khác); // Sao chép hàm tạo<a href="direct_initialization" title="cpp/language/direct initialization">direct-initialization</a>hoặc<a href="copy_initialization" title="cpp/language/copy initialization">copy-initialization</a>// x (x Khác);  // Lỗi: Loại tham số không chính xác<a href="overload_resolution" title="cpp/language/overload resolution">overload resolution</a>};<a href="copy_elision" title="cpp/language/copy elision">elided</a> </p>
<ul>
<li>Liên minh y<code>T a = b;</code>hoặc<code>T a(b);</code>là<code>b</code>{<code>T</code>Số lượng các yếu tố để sao chép</li>
<li>{<code>f(a);</code>là<code>a</code>{<code>T</code>Và<code>f</code>khoảng cách<code>void f(T t)</code>Số lượng các yếu tố để sao chép</li>
<li>    Y (y &amp; other, int num = 1); // Sao chép hàm tạo với nhiều tham số<code>return a;</code>// y (y &amp; other, int num);     // Lỗi: `num` không có đối số mặc định<code>T f()</code>là<code>a</code>{<code>T</code>};<a href="move_constructor" title="cpp/language/move constructor">move constructor</a>.</li>
</ul> <h3 id="Implicitly-declared_copy_constructor">Trình xây dựng bản sao được gọi bất cứ khi nào một đối tượng là</h3> <p>(qua<a href="explicit" title="cpp/language/explicit">explicit</a> <span class="kw1">};</span> <span class="kw1"> </span>) từ một đối tượng khác cùng loại (trừ khi<code>T::T(const T&amp;)</code>chọn một kết hợp tốt hơn hoặc cuộc gọi là</p>
<ul>
<li>), bao gồm<code>B</code>của<code>T</code>Khởi tạo:<span class="kw4">hằng số</span>B<span class="sy3">Không có giá trị</span>hoặc<span class="kw4">hằng số</span> <span class="kw4">bay hơi</span>B<span class="sy3">Không có giá trị</span>Số lượng các yếu tố để sao chép</li>
<li>    // Miễn là họ tuân theo cú pháp khai báo chức năng chung<code>M</code>của<code>T</code>Đối số chức năng vượt qua:<span class="kw4">hằng số</span>M<span class="sy3">Không có giá trị</span>hoặc<span class="kw4">hằng số</span> <span class="kw4">bay hơi</span>M<span class="sy3">Không có giá trị</span>.</li>
</ul> <p>trở lại chức năng:<code>T::T(T&amp;)</code>.</p>
<p>bên trong một chức năng như<span class="kw4">bay hơi</span>// y &amp; toán tử = (y &amp;, int num = 1);        // Lỗi: có các tham số không đối tượng khác</p>
<p>, không có<code>T::T(const T&amp;)</code>Và<code>T::T(T&amp;)</code>.</p>
<table class="t-rev-begin"> <tr class="t-rev t-since-cxx11">
<td> <p>Trình xây dựng bản sao được tuyên bố ngầm<span class="kw1">#include &lt;Istream&gt;</span>.</p>
</td> <td><span class="t-mark-rev t-since-cxx11">(kể từ C ++ 11)</span></td>
</tr> </table> <p>Nếu không có bộ xây dựng sao chép do người dùng xác định<span class="t-rev-inl t-until-cxx17"><span><a href="except_spec" title="cpp/language/except spec">dynamic exception specification</a></span><span><span class="t-mark-rev t-until-cxx17">xáo trộn</span></span></span><span class="t-rev-inl t-since-cxx17"><span><a href="noexcept_spec" title="cpp/language/noexcept spec">noexcept specification</a></span><span><span class="t-mark-rev t-since-cxx17">(C ++ 20)</span></span></span>.</p>
<h3 id="Implicitly-defined_copy_constructor">thành viên của lớp học của nó. Trình xây dựng bản sao được khai báo ngầm này có biểu mẫu</h3> <p>Nếu tất cả những điều sau đây là đúng:<a href="definition#ODR-use" title="cpp/language/definition">odr-used</a><span class="t-rev-inl t-since-cxx11"><span>hoặc<a href="constant_expression#Functions_and_variables_needed_for_constant_evaluation" title="cpp/language/constant expression">needed for constant evaluation</a></span><span><span class="t-mark-rev t-since-cxx11">(kể từ C ++ 11)</span></span></span>từng cơ sở trực tiếp và ảo<code><a href="../string/byte/memmove" title="cpp/string/byte/memmove">std::memmove</a></code>có một hàm tạo bản sao có tham số thuộc loại</p>
<table class="t-rev-begin"> <tr class="t-rev t-since-cxx11">
<td> <p>thuộc loại lớp hoặc mảng loại lớp có hàm tạo bản sao có tham số thuộc loại<span class="t-rev-inl t-until-cxx23"><span><a href="constexpr#constexpr_constructor" title="cpp/language/constexpr">constexpr constructor</a></span><span><span class="t-mark-rev t-until-cxx23">(Cho đến C ++ 23)</span></span></span><span class="t-rev-inl t-since-cxx23"><span><a href="constexpr#constexpr_function" title="cpp/language/constexpr">constexpr function</a></span><span><span class="t-mark-rev t-since-cxx23">(kể từ C ++ 23)</span></span></span>Nếu không, hàm tạo bản sao được khai báo ngầm là<span class="kw4">constexpr</span>.</p>
<p>Do các quy tắc này, hàm tạo bản sao được khai báo ngầm không thể liên kết với một<code>T</code>Một lớp có thể có nhiều hàm tạo bản sao, ví dụ: cả hai</p>
</td> <td><span class="t-mark-rev t-since-cxx11">(kể từ C ++ 11)</span></td>
</tr> </table> <h3 id="Deleted_copy_constructor">Ngay cả khi có một số trình xây dựng bản sao do người dùng xác định</h3> <p>Trình xây dựng bản sao được khai báo ngầm (hoặc mặc định trên khai báo đầu tiên) có một đặc tả ngoại lệ như được mô tả trong<span class="t-rev-inl t-since-cxx11"><span>Bởi vì toán tử gán bản sao luôn được khai báo cho bất kỳ lớp nào, toán tử gán lớp cơ sở luôn được ẩn. Nếu a</span><span><span class="t-mark-rev t-since-cxx11">(kể từ C ++ 11)</span></span></span>Chất xây dựng bản sao được xác định ngầm<code>T</code>khoảng cách<span class="t-rev-inl t-until-cxx11"><span>void print_container (const std :: deque &lt;int&gt; &amp; c) </span><span><span class="t-mark-rev t-until-cxx11">(Cho đến C ++ 11)</span></span></span><span class="t-rev-inl t-since-cxx11"><span>Toán tử gán bản sao được xác định ngầm</span><span><span class="t-mark-rev t-since-cxx11">(kể từ C ++ 11)</span></span></span>Nếu toán tử gán bản sao được tuyên bố ngầm không bị xóa cũng không tầm thường, thì nó được xác định (nghĩa là cơ thể chức năng được tạo và biên dịch) bởi trình biên dịch nếu</p>
<table class="t-rev-begin"> <tr class="t-rev t-since-cxx11">
<td> <ul><li> <code>T</code>Nếu hàm xây dựng bản sao được khai báo ngầm không bị xóa, thì nó sẽ được xác định (nghĩa là cơ thể hàm được tạo và biên dịch) bởi trình biên dịch nếu</li></ul> </td> <td><span class="t-mark-rev t-since-cxx11">(kể từ C ++ 11)</span></td>
</tr> </table> <ul>
<li> <code>T</code>Toán tử gán bản sao được xác định ngầm cho một lớp<a href="object#Potentially_constructed_subobject" title="cpp/language/object">potentially constructed subobject</a>Toán tử gán được chọn để sao chép từng tiểu đơn lớp cơ sở trực tiếp là hàm constexpr và<code>M</code>. Đối với các loại liên minh, hàm tạo bản sao được xác định ngầm sẽ sao chép biểu diễn đối tượng (như bởi</li>
<li> <code>M</code>). Đối với các loại lớp không liên kết, hàm tạo thực hiện bản sao toàn thành viên của các cơ sở của đối tượng và các thành viên không tĩnh, theo thứ tự khởi tạo của họ, sử dụng khởi tạo trực tiếp.<span class="t-rev-inl t-since-cxx11"><span>Nếu điều này đáp ứng các yêu cầu của một</span><span><span class="t-mark-rev t-since-cxx11">(kể từ C ++ 11)</span></span></span>, hàm tạo bản sao được tạo là</li>
<li>Việc tạo ra hàm tạo bản sao được xác định ngầm được xác định<code>M</code>có trình điều khiển phân công bản sao do người dùng xác định hoặc người dùng do người dùng xác định.</li>
<ul>
<li>Toán tử gán bản sao được xác định ngầm cho một lớp</li>
<li>Việc tạo ra toán tử gán bản sao được xác định ngầm được xác định<a href="union#Union-like_classes" title="cpp/language/union">variant member</a>có một hàm tạo phân hủy người dùng hoặc trình xây dựng bản sao phát hành của người dùng.</li>
</ul>
</ul> <table class="t-rev-begin"> <tr class="t-rev t-since-cxx11">
<td> <p>Đã xóa trình xây dựng bản sao<code>T</code>(c)<code>T</code>tuyên bố a<a href="move_constructor" title="cpp/language/move constructor">move constructor</a>hoặc<a href="move_assignment" title="cpp/language/move assignment">move assignment operator</a>.</p>
</td> <td><span class="t-mark-rev t-since-cxx11">(kể từ C ++ 11)</span></td>
</tr> </table> <h3 id="Trivial_copy_constructor">Những người được tuyên bố ngầm</h3> <p>Sao chép hàm tạo cho lớp<code>T</code>có một thành viên dữ liệu không tĩnh thuộc loại tham chiếu RValue.</p>
<ul>
<li>(hoặc có thể là mảng đa chiều của chúng) như vậy</li>
<li> <code>T</code>Nếu bất kỳ điều kiện nào sau đây được thỏa mãn:</li>
<li> <code>T</code>có một thành viên dữ liệu không tĩnh thuộc loại không có đủ điều kiện const (hoặc có thể là mảng đa chiều của chúng).</li>
<li>có một kẻ phá hủy đó là<code>T</code>có a</li>
<li>bị xóa hoặc<code>T</code>có a</li>
</ul> <p>không thể truy cập được từ hàm tạo bản sao hoặc</p>
<p><a href="../named_req/triviallycopyable" title="cpp/named req/TriviallyCopyable">TriviallyCopyable</a>độ phân giải quá tải như được áp dụng để tìm<code><a href="../string/byte/memmove" title="cpp/string/byte/memmove">std::memmove</a></code>Chất xây dựng bản sao</p>
<h3 id="Eligible_copy_constructor">Trình xây dựng bản sao được khai báo ngầm cho lớp</h3> <table class="t-rev-begin"> <tr class="t-rev t-until-cxx11">
<td> <p>Trình xây dựng bản sao tầm thường</p>
</td> <td><span class="t-mark-rev t-until-cxx11">(Cho đến C ++ 11)</span></td>
</tr> <tr class="t-rev t-since-cxx11 t-until-cxx20">
<td> <p>Trình xây dựng bản sao cho lớp</p>
</td> <td>
<span class="t-mark-rev t-since-cxx11">(kể từ C ++ 11)</span><br/><span class="t-mark-rev t-until-cxx20">chỉ vào một yếu tố của chuỗi,</span>
</td>
</tr> <tr class="t-rev t-since-cxx20">
<td> <p>là tầm thường nếu tất cả những điều sau đây là đúng:</p>
<ul>
<li>Toán tử gán bản sao cho lớp</li>
<li>Để cho một số đối tượng máy phát<a href="constraints" title="cpp/language/constraints">associated constraints</a>là tầm thường nếu tất cả những điều sau đây là đúng:</li>
<li>Nó không được cung cấp người dùng (nghĩa là nó được xác định ngầm hoặc mặc định);<a href="constraints#Partial_ordering_of_constraints" title="cpp/language/constraints">more constrained</a>không có chức năng thành viên ảo;</li>
</ul> </td> <td><span class="t-mark-rev t-since-cxx20">(phép chiếu danh tính).</span></td>
</tr> </table> <p>Trình xây dựng bản sao được chọn cho mọi cơ sở trực tiếp của<a href="lifetime#Implicit-lifetime_types" title="cpp/language/lifetime">implicit-lifetime type</a>Trình xây dựng bản sao được chọn cho mọi loại thành viên loại (hoặc mảng thuộc loại lớp) của<a href="../named_req/triviallycopyable" title="cpp/named req/TriviallyCopyable">trivially copyable type</a>.</p>
<h3 id="Notes">Ghi chú</h3> <p>Một hàm tạo bản sao tầm thường cho một lớp không liên kết sao chép hiệu quả mọi tiểu trường vô hướng (bao gồm, đệ quy, tiểu mục của các tiểu mục, v.v.) của đối số và không thực hiện hành động nào khác. Tuy nhiên, các byte đệm không cần phải được sao chép và ngay cả các biểu diễn đối tượng của các tiểu mục được sao chép không cần phải giống như các giá trị của chúng giống hệt nhau.<a href="copy_elision" title="cpp/language/copy elision">copy elision</a>.</p>
<h3 id="Example">Ví dụ</h3> <div class="cpp source-cpp"><pre data-language="cpp">Các đối tượng có thể được sao chép bằng cách sao chép các biểu diễn đối tượng của chúng theo cách thủ công, ví dụ: với</pre></div> <h3 id="Defect_reports">Báo cáo khiếm khuyết</h3> <p>Các báo cáo khiếm khuyết thay đổi hành vi sau đây được áp dụng hồi tố cho các tiêu chuẩn C ++ được công bố trước đó.</p>
<table class="dsctable"> <tr> <th>Dr</th> <th>Áp dụng cho</th> <th>Hành vi như được công bố</th> <th>Hành vi chính xác</th>
</tr> <tr> <td>
<a class="external text" href="https://cplusplus.github.io/CWG/issues/1353.html" rel="nofollow">CWG 1353</a> </td> <td>C ++ 98</td> <td>. Tất cả các loại dữ liệu tương thích với ngôn ngữ C (loại POD) đều có thể sao chép tầm thường.<br/>, nếu có, được thỏa mãn, và</td> <td>Không có toán tử gán bản sao với cùng loại tham số đầu tiên và cùng một cv/ref-aperifers (nếu có)</td>
</tr> <tr> <td>
<a class="external text" href="https://cplusplus.github.io/CWG/issues/2094.html" rel="nofollow">CWG 2094</a> </td> <td>C ++ 11</td> <td>Trình xây dựng bản sao đủ điều kiện<a class="external text" href="https://cplusplus.github.io/CWG/issues/496.html" rel="nofollow">CWG issue 496</a>)</td> <td>Nếu cả hai toán tử gán bản sao và di chuyển được cung cấp, độ phân giải quá tải sẽ chọn gán di chuyển nếu đối số là một</td>
</tr> <tr> <td>
<a class="external text" href="https://cplusplus.github.io/CWG/issues/2171.html" rel="nofollow">CWG 2171</a> </td> <td>C ++ 11</td> <td>
<code>X(X&amp;) = default</code>(Hoặc là a</td> <td>chẳng hạn như tạm thời không tên hoặc một</td>
</tr>
</table> <h3 id="See_also">(chức năng)</h3> <ul>
<li> <a href="converting_constructor" title="cpp/language/converting constructor">converting constructor</a> </li>
<li> <a href="copy_assignment" title="cpp/language/copy assignment">copy assignment</a> </li>
<li> <a href="copy_elision" title="cpp/language/copy elision">copy elision</a> </li>
<li> <a href="default_constructor" title="cpp/language/default constructor">default constructor</a> </li>
<li> <a href="destructor" title="cpp/language/destructor">destructor</a> </li>
<li> <a href="explicit" title="cpp/language/explicit"><code>explicit</code></a> </li>
<li> <a href="initialization" title="cpp/language/initialization">initialization</a> <ul>
<li> <a href="aggregate_initialization" title="cpp/language/aggregate initialization">aggregate initialization</a> </li>
<li> <a href="constant_initialization" title="cpp/language/constant initialization">constant initialization</a> </li>
<li> <a href="copy_initialization" title="cpp/language/copy initialization">copy initialization</a> </li>
<li> <a href="default_initialization" title="cpp/language/default initialization">default initialization</a> </li>
<li> <a href="direct_initialization" title="cpp/language/direct initialization">direct initialization</a> </li>
<li> <a class="mw-redirect" href="initializer_list" title="cpp/language/initializer list">initializer list</a> </li>
<li> <a href="list_initialization" title="cpp/language/list initialization">list initialization</a> </li>
<li> <a href="reference_initialization" title="cpp/language/reference initialization">reference initialization</a> </li>
<li> <a href="value_initialization" title="cpp/language/value initialization">value initialization</a> </li>
<li> <a href="zero_initialization" title="cpp/language/zero initialization">zero initialization</a> </li>
</ul> </li>
<li> <a href="move_assignment" title="cpp/language/move assignment">move assignment</a> </li>
<li> <a href="move_constructor" title="cpp/language/move constructor">move constructor</a> </li>
<li> <a href="new" title="cpp/language/new"><code>new</code></a> </li>
</ul> <div class="_attribution">
<p class="_attribution-p">© CPPReference.com<br/>Được cấp phép theo giấy phép Creative Commons Attribution-Sharealike không được chứng minh v3.0.<br/>
<a class="_attribution-link" href="https://en.cppreference.com/w/cpp/language/copy_constructor">https://en.cppreference.com/w/cpp/language/copy_constructor</a>
</p>
</div>
