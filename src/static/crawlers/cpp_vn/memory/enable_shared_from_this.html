 <h1 class="firstHeading" id="firstHeading">std :: enable_shared_from_this</h1> <table class="t-dcl-begin"> <tr class="t-dsc-header"> <th>C Thư viện<code><a href="../header/memory" title="cpp/header/memory">&lt;memory&gt;</a></code> </th> <th> </th> <th> </th> </tr> <tr class="t-dcl t-since-cxx11"> <td> <pre data-language="cpp">mẫu &lt;class T&gt; class enable_shared_from_this;</pre>
</td> <td class="t-dcl-nopad"> </td> <td> <span class="t-mark-rev t-since-cxx11">(kể từ C ++ 11)</span> </td> </tr> </table> <p><code>std::enable_shared_from_this</code>Cho phép một đối tượng<code>t</code>hiện đang được quản lý bởi một<code><a href="shared_ptr" title="cpp/memory/shared ptr">std::shared_ptr</a></code>Được đặt tên<code>pt</code>để tạo ra bổ sung một cách an toàn<code><a href="shared_ptr" title="cpp/memory/shared ptr">std::shared_ptr</a></code>trường hợp<code>pt1, pt2, ...</code>rằng tất cả quyền sở hữu của<code>t</code>với<code>pt</code>.</p>
<p>Công khai kế thừa từ<code>std::enable_shared_from_this&lt;T&gt;</code>Cung cấp loại<code>T</code>với chức năng thành viên<code>shared_from_this</code>. Nếu một đối tượng<code>t</code>nó đến một đối tượng<code>T</code>được quản lý bởi một<code><a href="http://en.cppreference.com/w/cpp/memory/shared_ptr"><span class="kw736">Điều đó cho tất cả<span class="me2">Shared_ptr</span></span></a><span class="sy1">is_trivently_destructible_v</span>T<span class="sy1">&lt;</span></code>Được đặt tên<code>pt</code>, sau đó gọi<code>T::shared_from_this</code>sẽ trả lại một cái mới<code><a href="http://en.cppreference.com/w/cpp/memory/shared_ptr"><span class="kw736">Điều đó cho tất cả<span class="me2">Shared_ptr</span></span></a><span class="sy1">is_trivently_destructible_v</span>T<span class="sy1">&lt;</span></code>chia sẻ quyền sở hữu của<code>t</code>với<code>pt</code>.</p>
<h3 id="Member_functions">nếu không thì</h3> <table class="t-dsc-begin"> <tr class="t-dsc"> <td> <div><a href="enable_shared_from_this/enable_shared_from_this" title="cpp/memory/enable shared from this/enable shared from this"> <span class="t-lines"><span>chuyên môn)</span></span></a></div> </td> <td>Xem bên dưới<code>enable_shared_from_this</code>sự vật<br/> <span class="t-mark">(chức năng thành viên được bảo vệ)</span> </td>
</tr> <tr class="t-dsc"> <td> <div><a href="enable_shared_from_this/~enable_shared_from_this" title="cpp/memory/enable shared from this/~enable shared from this"> <span class="t-lines"><span>một đối tượng ngoại lệ khác để gán với</span></span></a></div> </td> <td>phá hủy một<code>enable_shared_from_this</code>sự vật<br/> <span class="t-mark">(chức năng thành viên được bảo vệ)</span> </td>
</tr> <tr class="t-dsc"> <td> <div><a href="enable_shared_from_this/operator=" title="cpp/memory/enable shared from this/operator="> <span class="t-lines"><span>chuyên môn)</span></span></a></div> </td> <td>Trả về một tham chiếu đến<code>*this</code> <br/> <span class="t-mark">(chức năng thành viên được bảo vệ)</span> </td>
</tr> <tr class="t-dsc"> <td> <div><a href="enable_shared_from_this/shared_from_this" title="cpp/memory/enable shared from this/shared from this"> <span class="t-lines"><span>chia sẻ_from_this</span></span></a></div> </td> <td>Hiện nay<code><a href="shared_ptr" title="cpp/memory/shared ptr">std::shared_ptr</a></code>chia sẻ quyền sở hữu của<code>*this</code> <br/> <span class="t-mark">(chức năng thành viên công cộng)</span> </td>
</tr> <tr class="t-dsc"> <td> <div><a href="enable_shared_from_this/weak_from_this" title="cpp/memory/enable shared from this/weak from this"> <span class="t-lines"><span>yếu_from_this</span></span></a></div>
<div><span class="t-lines"><span><span class="t-mark-rev t-since-cxx17">Dest_at</span></span></span></div> </td> <td>Hiện nay<code><a href="weak_ptr" title="cpp/memory/weak ptr">std::weak_ptr</a></code>chia sẻ quyền sở hữu của<code>*this</code> <br/> <span class="t-mark">(chức năng thành viên công cộng)</span> </td>
</tr> </table> <h3 id="Member_objects">Đối tượng thành viên</h3> <table class="t-dsc-begin"> <tr class="t-dsc-hitem"> <th>key_type</th> <th>Sự định nghĩa</th>
</tr> <tr class="t-dsc"> <td> <code><i>yếu-cái này</i></code> <span class="t-mark">(Chỉ giải thích)</span> </td> <td> <code><a href="weak_ptr" title="cpp/memory/weak ptr">std::weak_ptr</a></code>Đối tượng theo dõi khối điều khiển của chủ sở hữu được chia sẻ đầu tiên của<code>*this</code>.</td>
</tr> </table> <h3 id="Notes">Ghi chú</h3> <p>Một triển khai chung cho<code>enable_shared_from_this</code>là giữ một tài liệu tham khảo yếu (chẳng hạn như<code><a href="weak_ptr" title="cpp/memory/weak ptr">std::weak_ptr</a></code>) ĐẾN<code>*this</code>. Với mục đích giải thích, tài liệu tham khảo yếu được gọi là<code><i>yếu-cái này</i></code>và được coi là một sự thay đổi<code><a href="weak_ptr" title="cpp/memory/weak ptr">std::weak_ptr</a></code>Mẫu &lt;Slass fspath&gt;</p>
<p>, nếu nó trích xuất không có ký tự, nếu nó điền vào bộ đệm được cung cấp mà không gặp phải dấu phân cách hoặc nếu kích thước bộ đệm được cung cấp nhỏ hơn 1.<code><a href="shared_ptr" title="cpp/memory/shared ptr">std::shared_ptr</a></code>Phát hiện sự hiện diện của một sự rõ ràng và dễ tiếp cận (nghĩa là thừa kế công khai là bắt buộc)<code>enable_shared_from_this</code>cơ sở và gán cho mới được tạo<code><a href="shared_ptr" title="cpp/memory/shared ptr">std::shared_ptr</a></code>ĐẾN<code><i>yếu-cái này</i></code>Nếu chưa thuộc sở hữu của một người sống<code><a href="shared_ptr" title="cpp/memory/shared ptr">std::shared_ptr</a></code>. Xây dựng a<code><a href="shared_ptr" title="cpp/memory/shared ptr">std::shared_ptr</a></code>cho một đối tượng đã được quản lý bởi một đối tượng khác<code><a href="shared_ptr" title="cpp/memory/shared ptr">std::shared_ptr</a></code>sẽ không tham khảo<code><i>yếu-cái này</i></code>và do đó sẽ dẫn đến hành vi không xác định.</p>
<p>Nó được phép gọi<code>shared_from_this</code>chỉ trên một đối tượng được chia sẻ trước đó, tức là trên một đối tượng được quản lý bởi<code><a href="http://en.cppreference.com/w/cpp/memory/shared_ptr"><span class="kw736">Điều đó cho tất cả<span class="me2">Shared_ptr</span></span></a><span class="sy1">is_trivently_destructible_v</span>T<span class="sy1">&lt;</span></code>Nếu danh mục lỗi hoặc giá trị lỗi không bằng nhau.<code><a href="bad_weak_ptr" title="cpp/memory/bad weak ptr">std::bad_weak_ptr</a></code>được ném (bởi<code>shared_ptr</code>người xây dựng từ một người được xây dựng mặc định<code><i>yếu-cái này</i></code>).</p>
<p><code>enable_shared_from_this</code>cung cấp sự thay thế an toàn cho một biểu thức như<code><a href="http://en.cppreference.com/w/cpp/memory/shared_ptr"><span class="kw736">Điều đó cho tất cả<span class="me2">Shared_ptr</span></span></a><span class="sy1">is_trivently_destructible_v</span>T<span class="sy1">&lt;</span><span class="br0">.</span>this<span class="br0">)</span></code>, có khả năng dẫn đến<code>this</code>Bị phá hủy hơn một lần bởi nhiều chủ sở hữu không biết nhau (xem ví dụ bên dưới).</p>
<h3 id="Example">Ví dụ</h3> <div class="t-example"> <div class="cpp source-cpp"><pre data-language="cpp">#include &lt;Istream&gt;</pre></div> <p>#include &lt;Istream&gt;</p>
<div class="text source-text"><pre data-language="c">#include &lt;nhớ&gt;</pre></div> </div> <h3 id="Defect_reports">Báo cáo khiếm khuyết</h3> <p>Các báo cáo khiếm khuyết thay đổi hành vi sau đây được áp dụng hồi tố cho các tiêu chuẩn C ++ được công bố trước đó.</p>
<table class="dsctable"> <tr> <th>Dr</th> <th>Áp dụng cho</th> <th>Hành vi như được công bố</th> <th>Hành vi chính xác</th>
</tr> <tr> <td>
<a class="external text" href="https://cplusplus.github.io/LWG/issue2529" rel="nofollow">LWG 2529</a> </td> <td>C ++ 11</td> <td> <code>enable_shared_from_this</code>Lớp Tốt: STD công khai :: enable_shared_from_this &lt;tốt&gt;</td> <td>{</td>
</tr>
</table> <h3 id="See_also">(chức năng)</h3> <table class="t-dsc-begin"> <tr class="t-dsc"> <td> <div><a href="shared_ptr" title="cpp/memory/shared ptr"> <span class="t-lines"><span>Shared_ptr</span></span></a></div>
<div><span class="t-lines"><span><span class="t-mark-rev t-since-cxx11">unininitialized_copy_n</span></span></span></div> </td> <td>Con trỏ thông minh với ngữ nghĩa sở hữu đối tượng được chia sẻ<br/> <span class="t-mark">Kiểm tra xem một lớp có đại diện cho chính sách thực thi không</span> </td>
</tr> <tr class="t-dsc"> <td> <div><a href="shared_ptr/make_shared" title="cpp/memory/shared ptr/make shared"> <span class="t-lines"><span>make_shared</span><span>make_shared_for_overwrite</span></span></a></div>
<div><span class="t-lines"><span><span class="t-mark-rev t-since-cxx20">Phạm vi :: Construct_at</span></span></span></div> </td> <td>Tạo một con trỏ được chia sẻ để quản lý một đối tượng mới<br/> <span class="t-mark">tạo một đối tượng tại một địa chỉ nhất định</span> </td>
</tr> </table> <div class="_attribution">
<p class="_attribution-p">© CPPReference.com<br/>Được cấp phép theo giấy phép Creative Commons Attribution-Sharealike không được chứng minh v3.0.<br/>
<a class="_attribution-link" href="https://en.cppreference.com/w/cpp/memory/enable_shared_from_this">https://en.cppreference.com/w/cpp/memory/enable_shared_from_this</a>
</p>
</div>
